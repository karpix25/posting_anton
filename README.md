# üöÄ –ê–≤—Ç–æ –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ ‚Äî –°–∏—Å—Ç–µ–º–∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –ö–æ–Ω—Ç–µ–Ω—Ç–∞

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π.

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã](#-–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–±–æ—Ç—ã)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –¥–µ–ø–ª–æ–π](#-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–¥–µ–ø–ª–æ–π)
- [API Endpoints](#-api-endpoints)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞:

1. **–°–±–æ—Ä –≤–∏–¥–µ–æ** —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ (39,000+ —Ñ–∞–π–ª–æ–≤)
2. **AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è** —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–µ–Ω–¥–∞
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—É–±–ª–∏–∫–∞—Ü–∏–π —Å —É—á–µ—Ç–æ–º –∫–≤–æ—Ç –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Upload Post API
5. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** –∏ –∫–≤–æ—Ç –ø–æ –±—Ä–µ–Ω–¥–∞–º

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- Instagram Reels
- TikTok
- YouTube Shorts

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±—Ä–µ–Ω–¥—ã
- **PayWorld** ‚Äî –ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **LifeProtein** ‚Äî –ü—Ä–æ—Ç–µ–∏–Ω–æ–≤—ã–µ –Ω–∞–ø–∏—Ç–∫–∏
- **GQbox** ‚Äî –ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –∑–∞—Ä—è–¥–∫–∏
- **REX** ‚Äî –í–∫—É—Å–æ–≤—ã–µ –±—Ä–∞—É–Ω–∏-–ø–µ—Ä–µ–∫—É—Å—ã
- **Synergetic** ‚Äî –≠–∫–æ-—Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –¥–æ–º–∞

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "Storage Layer"
        YD[–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫<br/>~40k –≤–∏–¥–µ–æ]
        PG[(PostgreSQL<br/>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + –ò—Å—Ç–æ—Ä–∏—è)]
        RD[(Redis<br/>–û—á–µ—Ä–µ–¥–∏ Celery)]
    end
    
    subgraph "Backend Services"
        API[FastAPI<br/>REST API]
        SCHED[DynamicScheduler<br/>Cron –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫]
        CELERY[Celery Workers<br/>–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏]
    end
    
    subgraph "External Services"
        AI[OpenRouter AI<br/>GPT-4 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è]
        UP[Upload Post API<br/>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ —Å–æ—Ü—Å–µ—Ç–∏]
    end
    
    subgraph "Frontend"
        DASH[Dashboard<br/>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ]
    end
    
    YD -->|get_files| API
    API -->|read/write config| PG
    API -->|schedule tasks| RD
    RD -->|consume| CELERY
    CELERY -->|download link| YD
    CELERY -->|generate caption| AI
    CELERY -->|publish| UP
    CELERY -->|update stats| PG
    DASH -->|HTTP requests| API
    SCHED -->|trigger automation| CELERY

    style YD fill:#ff9800
    style PG fill:#2196f3
    style RD fill:#f44336
    style API fill:#4caf50
    style CELERY fill:#9c27b0
    style AI fill:#00bcd4
    style UP fill:#ff5722
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- Python 3.11+
- FastAPI (REST API)
- Celery (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏)
- SQLModel + AsyncPG (ORM + PostgreSQL)
- APScheduler (Cron-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)

**Storage:**
- PostgreSQL (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∏—Å—Ç–æ—Ä–∏—è, –∫–≤–æ—Ç—ã)
- Redis (–æ—á–µ—Ä–µ–¥–∏ Celery)
- –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ (–≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã)

**External APIs:**
- OpenRouter AI (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ GPT-4)
- Upload Post API (–ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Instagram/TikTok/YouTube)
- Yandex Disk API (–ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ)

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
```
/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/–ë—Ä–µ–Ω–¥-–ê–≤—Ç–æ—Ä/–≤–∏–¥–µ–æ.mp4
```

**–ü—Ä–∏–º–µ—Ä:**
```
/–ü–∏—Ç–∞–Ω–∏–µ/LifeProtein-–®–æ–∫–æ–ª–∞–¥-–ê–Ω–Ω–∞/promo_01.mp4
```

–ò–∑ —ç—Ç–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è:
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** –ü–∏—Ç–∞–Ω–∏–µ
- **–ë—Ä–µ–Ω–¥:** LifeProtein
- **–í–∫—É—Å/–¢–∏–ø:** –®–æ–∫–æ–ª–∞–¥
- **–ê–≤—Ç–æ—Ä:** –ê–Ω–Ω–∞

---

### 2Ô∏è‚É£ Cron-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Dashboard:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `1 2 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:01 –ú–°–ö)
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª—é–±–æ–µ cron-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ

**–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (`DynamicScheduler`):**
1. –ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ PostgreSQL
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ (100,000 –ª–∏–º–∏—Ç, 600s timeout)
3. –§–∏–ª—å—Ç—Ä—É–µ—Ç –≤–∏–¥–µ–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/–±—Ä–µ–Ω–¥–∞–º
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–≤–æ—Ç—ã (—Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–æ–≤ —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ)
5. –°–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∏–¥–µ–æ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º —Å–æ—Ü—Å–µ—Ç–µ–π
6. –°–æ–∑–¥–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π –Ω–∞ N –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥

---

### 3Ô∏è‚É£ Celery –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

**Workflow –æ–¥–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:**

```mermaid
sequenceDiagram
    participant Scheduler
    participant Celery
    participant Yandex
    participant AI
    participant UploadPost
    participant DB

    Scheduler->>DB: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å (status=queued)
    Scheduler->>Celery: –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É (ETA=publish_time)
    
    Note over Celery: –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    
    Celery->>Yandex: –ü–æ–ª—É—á–∏—Ç—å download_link
    Yandex-->>Celery: –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞
    
    Celery->>AI: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç (–ø—Ä–æ–º—Ç + –∞–≤—Ç–æ—Ä)
    AI-->>Celery: –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ + —Ö—ç—à—Ç–µ–≥–∏
    
    Celery->>UploadPost: POST /api/upload (video_url, caption)
    UploadPost-->>Celery: success=true
    
    Celery->>DB: –û–±–Ω–æ–≤–∏—Ç—å status=success
    Celery->>DB: –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å brand_stats
    
    alt –í—Å–µ –ø–æ—Å—Ç—ã —É—Å–ø–µ—à–Ω—ã
        Celery->>Yandex: –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ
    end
```

---

### 4Ô∏è‚É£ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–µ–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π **prompt**, –∫–æ—Ç–æ—Ä—ã–π:

- –£—á–∏—Ç—ã–≤–∞–µ—Ç **—Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞** (Telegram-–±–æ—Ç vs –Ø–Ω–¥–µ–∫—Å-—Å–µ—Ä–≤–∏—Å –¥–ª—è PayWorld)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç **–≤–∫—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞** (–®–æ–∫–æ–ª–∞–¥/–ö–æ–ª–ª–∞–≥–µ–Ω –¥–ª—è LifeProtein)
- –î–æ–±–∞–≤–ª—è–µ—Ç **–∏–º—è –∞–≤—Ç–æ—Ä–∞** –≤ –∫–æ–Ω—Ü–µ (`#by–ò–º—è`)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç **–∞—Ä—Ç–∏–∫—É–ª—ã** (WB, Ozon) –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- –§–æ—Ä–º–∏—Ä—É–µ—Ç **–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã**:
  - Instagram/TikTok: –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç + 20 —Ö—ç—à—Ç–µ–≥–æ–≤
  - YouTube: –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –æ–ø–∏—Å–∞–Ω–∏–µ (—Ä–∞–∑–¥–µ–ª–µ–Ω—ã `$$$`)

**–ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è LifeProtein:**
```
–í—Ö–æ–¥: /disk/–ü–∏—Ç–∞–Ω–∏–µ/LifeProtein-–®–æ–∫–æ–ª–∞–¥-–ú–∞—Ä–∏—è/video.mp4
–í—ã—Ö–æ–¥: 
"–£—Ç—Ä–æ–º –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤–∑—è–ª–∞ —à–æ–∫–æ–ª–∞–¥–Ω—ã–π –ø—Ä–æ—Ç–µ–∏–Ω–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫ ‚Äî 
—É–¥–∏–≤–∏–ª–∞—Å—å, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –Ω–∞—Å—ã—â–∞–µ—Ç. –ù–∞—à–ª–∞ –Ω–∞ wildberries ‚Äî #WW194190, 
–Ω–∞ ozon ‚Äî #1928680358. –¢–µ–ø–µ—Ä—å —ç—Ç–æ –º–æ–π must-have –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π.

#–ø—Ä–æ—Ç–µ–∏–Ω #—Ñ–∏—Ç–Ω–µ—Å #–∑–æ–∂ #—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ #–∑–¥–æ—Ä–æ–≤–æ–µ–ø–∏—Ç–∞–Ω–∏–µ ... (20 —Ö—ç—à—Ç–µ–≥–æ–≤)
#by–ú–∞—Ä–∏—è"
```

---

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Backend (`app/`)

#### `main.py` ‚Äî FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
**Endpoints:**
- `GET /api/config` ‚Äî –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `POST /api/config` ‚Äî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `POST /api/config/restore-defaults` ‚Äî –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AI –ø—Ä–æ–º—Ç—ã –∏–∑ seed
- `GET /api/schedule` ‚Äî –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- `POST /api/run` ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é
- `POST /api/profiles/sync` ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ Upload Post
- `GET /api/stats` ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∏–¥–µ–æ —Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞
- `GET /api/brands/stats` ‚Äî –ö–≤–æ—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –±—Ä–µ–Ω–¥–∞–º

#### `worker.py` ‚Äî Celery –∑–∞–¥–∞—á–∏
- `generate_daily_schedule()` ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- `post_content_task()` ‚Äî –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ
- `check_cleanup_task()` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ

#### `services/`
- **`yandex.py`** ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Disk API
  - `list_files()` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ (—Å retry 100k‚Üí5k‚Üí2k)
  - `get_download_link()` ‚Äî –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  - `delete_file()` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

- **`platforms.py`** ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Upload Post API
  - `publish_post()` ‚Äî –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Instagram/TikTok/YouTube
  - `get_profiles()` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π

- **`content_generator.py`** ‚Äî AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤
  - `generate_caption()` ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ OpenRouter (GPT-4)

- **`scheduler.py`** ‚Äî –õ–æ–≥–∏–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - `generate_schedule()` ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –ø–æ –ø—Ä–æ—Ñ–∏–ª—è–º
  - Quota management (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤)

- **`dynamic_scheduler.py`** ‚Äî Cron-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
  - –°–ª–µ–¥–∏—Ç –∑–∞ `cronSchedule` –≤ –ë–î
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç APScheduler job

- **`config_db.py`** ‚Äî –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
  - `migrate_file_to_db()` ‚Äî –ú–∏–≥—Ä–∞—Ü–∏—è config.json –≤ PostgreSQL
  - `get_db_config()` / `save_db_config()` ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

#### `models.py` ‚Äî ORM –º–æ–¥–µ–ª–∏
```python
class PostingHistory:
    profile_username: str
    platform: str
    video_path: str
    status: str  # queued, success, failed
    posted_at: datetime

class BrandStats:
    category: str
    brand: str
    month: str  # YYYY-MM
    published_count: int
    quota: int
```

#### `seed_data.py` ‚Äî –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–•—Ä–∞–Ω–∏—Ç AI –ø—Ä–æ–º—Ç—ã –¥–ª—è –≤—Å–µ—Ö –±—Ä–µ–Ω–¥–æ–≤ (PayWorld, LifeProtein, GQbox, REX, Synergetic).

---

### Frontend (`public/`)

**`index.html`** ‚Äî Single Page Application (Vanilla JS)

**–†–∞–∑–¥–µ–ª—ã:**
1. **Dashboard** ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤–∏–¥–µ–æ –Ω–∞ –¥–∏—Å–∫–µ, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ, –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
2. **AI Clients** ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º—Ç–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–µ–Ω–¥–∞
3. **Profiles** ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏ —Å–æ—Ü—Å–µ—Ç–µ–π + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
4. **Scheduler** ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
5. **Brands Quotas** ‚Äî –ö–≤–æ—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π –ø–æ –º–µ—Å—è—Ü–∞–º

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –¥–µ–ø–ª–æ–π

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# PostgreSQL
DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/dbname

# Redis
REDIS_URL=redis://localhost:6379/0

# API Keys
YANDEX_TOKEN=your_yandex_oauth_token
UPLOAD_POST_API_KEY=your_upload_post_key
OPENAI_API_KEY=your_openrouter_key

# OpenRouter Config
OPENAI_BASE_URL=https://openrouter.ai/api/v1
OPENAI_MODEL=openai/gpt-4

# Server
PORT=3001
```

### 2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
alembic upgrade head

# –ó–∞–ø—É—Å–∫ API
uvicorn app.main:app --host 0.0.0.0 --port 3001

# –ó–∞–ø—É—Å–∫ Celery worker (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
celery -A app.celery_app worker --loglevel=info

# –ó–∞–ø—É—Å–∫ Celery beat (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
celery -A app.celery_app beat --loglevel=info
```

### 3. Docker Compose

```bash
docker-compose -f docker-compose.python.yml up -d
```

**–°–µ—Ä–≤–∏—Å—ã:**
- `api` ‚Äî FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `worker` ‚Äî Celery worker
- `beat` ‚Äî Celery beat –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- `redis` ‚Äî Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π
- `postgres` ‚Äî PostgreSQL (–µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)

### 4. –î–µ–ø–ª–æ–π –Ω–∞ EasyPanel

1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –£–∫–∞–∑–∞—Ç—å Dockerfile: `Dockerfile`
4. –ü–æ—Ä—Ç: `3001`
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å Rebuild

---

## üì° API Endpoints

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/config` | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é |
| POST | `/api/config` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–∫–ª–∏–µ–Ω—Ç—ã, –ø—Ä–æ—Ñ–∏–ª–∏, –∫–≤–æ—Ç—ã) |
| POST | `/api/config/restore-defaults` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AI –ø—Ä–æ–º—Ç—ã –∏–∑ seed_data.py |

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/schedule` | –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è |
| POST | `/api/schedule` | –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (cron expression) |
| POST | `/api/run` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é |

### –ü—Ä–æ—Ñ–∏–ª–∏

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/profiles/sync` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ Upload Post API |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/stats` | –í–∏–¥–µ–æ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –∞–≤—Ç–æ—Ä–∞–º, –±—Ä–µ–Ω–¥–∞–º) |
| GET | `/api/brands/stats` | –ö–≤–æ—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ/–ø–ª–∞–Ω) |
| POST | `/api/brands/quotas` | –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–æ—Ç—É –¥–ª—è –±—Ä–µ–Ω–¥–∞ |

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ config.json (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PostgreSQL)

```json
{
  "yandexFolders": ["/–ö–∞—Ç–µ–≥–æ—Ä–∏—è1", "/–ö–∞—Ç–µ–≥–æ—Ä–∏—è2"],
  "daysToGenerate": 7,
  "cronSchedule": "1 2 * * *",
  
  "clients": [
    {
      "name": "PayWorld",
      "regex": "–ü–ª–∞—Ç–∏",
      "prompt": "..."
    }
  ],
  
  "profiles": [
    {
      "username": "user123",
      "platforms": ["instagram", "tiktok"],
      "theme_key": "nutrition"
    }
  ],
  
  "brandQuotas": {
    "nutrition": {
      "lifeprotein": 100,
      "rex": 50
    }
  }
}
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ AI –ø—Ä–æ–º—Ç–æ–≤

–ï—Å–ª–∏ –ø—Ä–æ–º—Ç—ã –≤ UI –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:

**–í–∞—Ä–∏–∞–Ω—Ç 1 ‚Äî –ß–µ—Ä–µ–∑ curl:**
```bash
curl -X POST http://posting.focusmarket.su/api/config/restore-defaults
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 ‚Äî –ß–µ—Ä–µ–∑ HTML-—Ñ–∞–π–ª:**
–û—Ç–∫—Ä–æ–π—Ç–µ `restore_prompts.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É.

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# API –ª–æ–≥–∏
docker logs posting-api -f

# Celery worker –ª–æ–≥–∏
docker logs posting-worker -f

# Celery beat –ª–æ–≥–∏
docker logs posting-beat -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π

```bash
celery -A app.celery_app inspect active
celery -A app.celery_app inspect scheduled
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
SELECT category, brand, published_count, quota
FROM brand_stats
WHERE month = '2026-01';

-- –ò—Å—Ç–æ—Ä–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π
SELECT profile_username, platform, status, posted_at
FROM posting_history
ORDER BY posted_at DESC
LIMIT 50;
```

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫: "client has been closed"
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞).

### AI –ø—Ä–æ–º—Ç—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `POST /api/config/restore-defaults`

### Celery –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Redis –¥–æ—Å—Ç—É–ø–µ–Ω: `redis-cli ping`
2. Worker –∑–∞–ø—É—â–µ–Ω: `celery -A app.celery_app inspect active`
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. `UPLOAD_POST_API_KEY` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
2. –ü—Ä–æ—Ñ–∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (`/api/profiles/sync`)
3. –ö–≤–æ—Ç—ã –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω—ã

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary ‚Äî –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ SMM-–ø—É–±–ª–∏–∫–∞—Ü–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI.
